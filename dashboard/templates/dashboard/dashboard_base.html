
{% extends "base.html" %} {# <--- CORRE칂츾O: Usar base.html, n칚o dashboard_base #}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    /* Estilos mantidos do seu original */
    .dashboard-container { padding: 20px; }
    .metric-card { 
        background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #007cba;
    }
    .metric-card.critical { border-left-color: #dc3545; }
    .metric-card.warning { border-left-color: #ffc107; }
    .metric-card.success { border-left-color: #28a745; }
    .metric-value { font-size: 2.5em; font-weight: bold; color: #007cba; }
    .metric-label { color: #666; font-size: 0.9em; }
    .alert-badge { 
        display: inline-block; padding: 4px 8px; border-radius: 4px; 
        color: white; font-size: 0.8em; margin-left: 10px;
    }
    .alert-danger { background: #dc3545; }
    .alert-warning { background: #ffc107; color: #000; }
    .dashboard-grid { 
        display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
        gap: 20px; margin-bottom: 30px;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="d-flex justify-content-between align-items-center">
        <h1>游늯 Dashboard de Documentos</h1>
        {% if is_cycling %}
            <span class="badge bg-success">Modo TV</span>
        {% endif %}
    </div>
    
    <!-- Alertas -->
    {% if documentos_vencidos > 0 or documentos_a_vencer > 0 %}
    <div class="metric-card {% if documentos_vencidos > 0 %}critical{% else %}warning{% endif %}">
        <h3>丘멆잺 Alertas de Vencimento</h3>
        {% if documentos_vencidos > 0 %}
        <div class="alert-badge alert-danger">游댮 {{ documentos_vencidos }} documentos vencidos</div>
        {% endif %}
        {% if documentos_a_vencer > 0 %}
        <div class="alert-badge alert-warning">游리 {{ documentos_a_vencer }} documentos a vencer (30 dias)</div>
        {% endif %}
    </div>
    {% endif %}

    <!-- M칠tricas Principais -->
    <div class="dashboard-grid">
        <div class="metric-card">
            <div class="metric-value">{{ total_documentos }}</div>
            <div class="metric-label">Total de Documentos</div>
        </div>

        <div class="metric-card {% if documentos_vencidos > 0 %}critical{% else %}success{% endif %}">
            <div class="metric-value">{{ documentos_vencidos }}</div>
            <div class="metric-label">Documentos Vencidos</div>
        </div>

        <div class="metric-card {% if documentos_a_vencer > 0 %}warning{% else %}success{% endif %}">
            <div class="metric-value">{{ documentos_a_vencer }}</div>
            <div class="metric-label">A Vencer (30 dias)</div>
        </div>

        <div class="metric-card">
            <div class="metric-value">
                {% for status in status_data %}
                    {% if status.status == 'VIGENTE' %}{{ status.total }}{% endif %}
                {% endfor %}
            </div>
            <div class="metric-label">Documentos Vigentes</div>
        </div>
    </div>

    <!-- Status dos Documentos -->
    <div class="metric-card">
        <h3>游늵 Status dos Documentos</h3>
        {% for status in status_data %}
        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
            <strong>
                {% if status.status == 'VIGENTE' %}游릭 Vigente
                {% elif status.status == 'A_VENCER' %}游리 A Vencer
                {% elif status.status == 'VENCIDO' %}游댮 Vencido
                {% elif status.status == 'RENOVADO' %}游댯 Renovado
                {% else %}{{ status.status }}{% endif %}
            </strong>: {{ status.total }} documentos
            <div style="background: 
                {% if status.status == 'VIGENTE' %}#28a745
                {% elif status.status == 'A_VENCER' %}#ffc107
                {% elif status.status == 'VENCIDO' %}#dc3545
                {% else %}#007cba{% endif %}; 
                height: 10px; width: {{ status.total|divisibleby:total_documentos|default:0 }}%; border-radius: 5px; margin-top: 5px;">
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pr칩ximos Vencimentos -->
    {% if proximos_vencimentos %}
    <div class="metric-card">
        <h3>游늰 Pr칩ximos Vencimentos</h3>
        {% for documento in proximos_vencimentos %}
        <div style="padding: 8px; border-bottom: 1px solid #eee;">
            <strong>{{ documento.nome }}</strong><br>
            <small>Vencimento: {{ documento.data_vencimento|date:"d/m/Y" }} | 
                   Status: 
                   {% if documento.status == 'VIGENTE' %}游릭 Vigente
                   {% elif documento.status == 'A_VENCER' %}游리 A Vencer
                   {% elif documento.status == 'VENCIDO' %}游댮 Vencido
                   {% else %}{{ documento.status }}{% endif %}
            </small>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

{# SCRIPT PARA ROTA칂츾O AUTOM츼TICA #}
{% if next_dashboard_url %}
<script>
    setTimeout(function() {
        window.location.href = "{% url next_dashboard_url %}?cycle=true";
    }, {{ cycle_interval }});
</script>
{% endif %}
{% endblock %}


