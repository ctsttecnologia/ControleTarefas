{% extends "automovel/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'csscarro/tables.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <h2><i class="fas fa-calendar-alt me-2"></i>Lista de Agendamentos</h2>
    
    {% if user.is_authenticated %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <p class="mb-0">Olá, {{ user.username }}!</p>
        <div>
            
            
        </div>
    </div>
    {% endif %}

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="btn-group">
            <a href="{% url 'home' %}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-home"></i> Início
            </a>
            <a href="{% url 'usuario:logout' %}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-sign-out-alt"></i> Sair
            </a>
            <a href="{% url 'automovel:adicionar_agendamento' %}" class="btn btn-primary me-2">
                <i class="fas fa-plus-circle"></i> Novo Agendamento
            </a>
            <a href="{% url 'automovel:dashboard' %}" class="btn btn-info">
                <i class="fas fa-chart-bar"></i> Gráficos
            </a>
            <a href="{% url 'profile' %}" class="btn btn-outline-secondary">
                <i class="fas fa-user-cog"></i> Menu
            </a>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="thead-dark">
                        <tr>
                            <th>Carro</th>
                            <th>Data/Hora</th>
                            <th>Status</th>
                            <th>Assinatura</th>
                            <th>Checklist</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for agendamento in agendamentos %}
                        <tr>
                            <td>{{ agendamento.carro.marca }} {{ agendamento.carro.modelo }}</td>
                            <td>{{ agendamento.data_hora_agenda|date:"d/m/Y H:i" }}</td>
                            <td>
                                <span class="badge bg-{% if agendamento.status == 'concluido' %}success{% elif agendamento.status == 'cancelado' %}danger{% else %}warning{% endif %}">
                                    {{ agendamento.get_status_display }}
                                </span>
                            </td>
                            <td>
                                {% if agendamento.assinatura %}
                                    <img src="{{ agendamento.assinatura.url }}" width="100" class="img-thumbnail signature-thumbnail">
                                {% else %}
                                    <a href="{% url 'automovel:adicionar_assinatura' agendamento.pk %}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-signature"></i> Assinar
                                    </a>
                                {% endif %}
                            </td>
                            <td>
                                {% if agendamento.checklists_carro.exists %}
                                    <span class="badge bg-success">Completo</span>
                                {% else %}
                                    <a href="{% url 'automovel:checklist_carro' agendamento.pk %}" class="btn btn-sm btn-info">
                                        <i class="fas fa-clipboard-check"></i>Checklist
                                    </a>
                                {% endif %}
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <a href="{% url 'automovel:editar_agendamento' agendamento.pk %}" class="btn btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{% url 'automovel:excluir_agendamento' agendamento.pk %}" class="btn btn-danger">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                    <a href="{% url 'automovel:agendamento_fotos' agendamento.pk %}" class="btn btn-info">
                                        <i class="fas fa-images"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <i class="fas fa-calendar-times fa-2x mb-2"></i>
                                <p class="mb-0">Nenhum agendamento cadastrado.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Script para pré-visualizar assinaturas
document.addEventListener('DOMContentLoaded', function() {
    const signatureThumbnails = document.querySelectorAll('.signature-thumbnail');
    signatureThumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';
            
            const img = document.createElement('img');
            img.src = this.src;
            img.style.maxWidth = '90%';
            img.style.maxHeight = '90%';
            
            modal.appendChild(img);
            modal.addEventListener('click', () => document.body.removeChild(modal));
            document.body.appendChild(modal);
        });
    });
});
</script>
{% endblock %}
