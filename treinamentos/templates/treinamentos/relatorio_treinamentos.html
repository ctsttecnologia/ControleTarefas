
{% extends 'base.html' %}

{% block title %}Relatório de Treinamentos{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Relatório de Treinamentos</h1>
        <div class="my-4">              
            <a href="{% url 'treinamentos:dashboard' %}" class="btn btn-info">
                <i class="bi bi-speedometer"></i> Dashboard
            </a>

            <a href="{% url 'treinamentos:relatorio_geral_excel' %}?{{ request.GET.urlencode }}" class="btn btn-success">
                <i class="fas fa-file-excel"></i> Exportar para Excel
            </a>
        </div>
</div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-light">
            <h4>Filtros</h4>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3 align-items-center">
                <div class="col-auto">
                    <label for="ano" class="form-label">Ano:</label>
                    <select class="form-select" id="ano" name="ano">
                        <option value="">Todos os Anos</option>
                        {% for date in anos %}
                            <option value="{{ date.year }}" {% if request.GET.ano|stringformat:'s' == date.year|stringformat:'s' %}selected{% endif %}>{{ date.year }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <label for="tipo_curso" class="form-label">Tipo de Curso:</label>
                    <select class="form-select" id="tipo_curso" name="tipo_curso">
                        <option value="">Todos os Tipos</option>
                        {% for curso in tipos_curso %}
                            <option value="{{ curso.pk }}" {% if request.GET.tipo_curso|stringformat:'s' == curso.pk|stringformat:'s' %}selected{% endif %}>{{ curso.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary"><i class="bi bi-filter"></i> Filtrar</button>
                    <a href="{% url 'treinamentos:relatorio_treinamentos' %}" class="btn btn-secondary"><i class="bi bi-x-octagon"></i> Limpar Filtros</a>
                </div>
            </form>
        </div>
    </div>
    <div class="mb-3">
        
    </div>
    <div class="card">
        <div class="card-header bg-light">
            <h4>Resultados do Relatório</h4>
        </div>
        <div class="card-body">
            {% if object_list %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Nome do Treinamento</th>
                                <th>Tipo de Curso</th>
                                <th>Data de Início</th>
                                <th>Data de Vencimento</th>
                                <th>Status</th>
                                <th>Local</th>
                                <th>Responsável</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for treinamento in object_list %}
                                <tr>
                                    <td><a href="{{ treinamento.get_absolute_url }}">{{ treinamento.nome }}</a></td>
                                    <td>{{ treinamento.tipo_curso }}</td>
                                    <td>{{ treinamento.data_inicio|date:"d/m/Y" }}</td>
                                    <td>{{ treinamento.data_vencimento|date:"d/m/Y" }}</td>
                                    <td>{{ treinamento.get_status_display }}</td>
                                    <td>{{ treinamento.local }}</td>
                                    <td>{{ treinamento.responsavel|default:"Não definido" }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>Nenhum treinamento encontrado com os filtros selecionados.</p>
            {% endif %}
        </div>
        {% if is_paginated %}
            <div class="card-footer py-3">
                {% include 'pagination.html' with page=page_obj %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
