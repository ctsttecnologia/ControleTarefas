

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'csstarefa/detalhestyles.css' %}">
{% endblock %}

<!-- Barra de Navegação Principal -->    
{% include 'includes/header.html' %}
{% block content %}
<main class="task-detail-container">
    <div class="container">
        <div class="task-card">
            <div class="task-header">
                <div class="task-title-wrapper">
                    <h1 class="task-title">{{ tarefa.titulo }}</h1>
                    <div class="task-badges">
                        <span class="badge status-{{ tarefa.status }}">
                            {{ tarefa.get_status_display }}
                        </span>
                        <span class="badge priority-{{ tarefa.prioridade }}">
                            {{ tarefa.get_prioridade_display }}
                        </span>
                        {% if tarefa.atrasada %}
                        <span class="badge bg-danger">Atrasada</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="task-content">
                <section class="task-meta-section">
                    <h2 class="section-title">Informações Básicas</h2>
                    <div class="task-meta-grid">
                        <div class="meta-item">
                            <div class="meta-label">Criado por</div>
                            <div class="meta-value">{{ tarefa.usuario.username }}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Responsável</div>
                            <div class="meta-value">{{ tarefa.responsavel.username|default:"Não atribuído" }}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Data de criação</div>
                            <div class="meta-value">{{ tarefa.data_criacao|date:"d/m/Y H:i" }}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Prazo final</div>
                            <div class="meta-value">{{ tarefa.prazo|date:"d/m/Y"|default:"Não definido" }}</div>
                        </div>
                    </div>
                </section>

                <section class="task-meta-section">
                    <h2 class="section-title">Detalhes do Projeto</h2>
                    <div class="task-meta-grid">
                        <div class="meta-item">
                            <div class="meta-label">Projeto</div>
                            <div class="meta-value">{{ tarefa.projeto|default:"Não definido" }}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Duração Prevista</div>
                            <div class="meta-value">{{ tarefa.duracao_prevista|default:"Não definido" }} horas</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Tempo Gasto</div>
                            <div class="meta-value">{{ tarefa.tempo_gasto|default:"0" }} horas</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Progresso</div>
                            <div class="meta-value">{{ tarefa.progresso }}%</div>
                        </div>
                    </div>
                </section>

                <section class="task-meta-section">
                    <h2 class="section-title">Datas Importantes</h2>
                    <div class="task-meta-grid">
                        <div class="meta-item">
                            <div class="meta-label">Data de Início</div>
                            <div class="meta-value">{{ tarefa.data_inicio|date:"d/m/Y H:i" }}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Data Final</div>
                            <div class="meta-value">{{ tarefa.concluida_em|date:"d/m/Y H:i"|default:"-" }}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Última Atualização</div>
                            <div class="meta-value">{{ tarefa.data_atualizacao|date:"d/m/Y H:i" }}</div>
                        </div>
                    </div>
                </section>

                <section class="task-description-section">
                    <h2 class="section-title">Descrição</h2>
                    <div class="task-description">
                        {{ tarefa.descricao|linebreaks }}
                    </div>
                </section>

                <section class="task-comments-section">
                    <h2 class="section-title">Comentários</h2>
                    {% for comentario in comentarios %}
                    <div class="comment-card">
                        <div class="comment-header">
                            <span class="comment-author">{{ comentario.autor.username }}</span>
                            <span class="comment-date">{{ comentario.criado_em|date:"d/m/Y H:i" }}</span>
                        </div>
                        <div class="comment-text">{{ comentario.texto }}</div>
                    </div>
                    {% empty %}
                    <p class="no-comments">Nenhum comentário ainda.</p>
                    {% endfor %}
                </section>

                <section class="add-comment-section">
                    <h2 class="section-title">Adicionar Comentário</h2>
                    <form method="post" class="comment-form">
                        {% csrf_token %}
                        {{ form.texto }}
                        <button type="submit" class="btn btn-primary">Enviar Comentário</button>
                    </form>
                </section>
            </div>

            <div class="task-actions">
                <a href="{% url 'tarefas:listar_tarefas' %}" class="btn btn-secondary">Voltar para lista</a>
                <a href="{% url 'tarefas:editar_tarefa' tarefa.pk %}" class="btn btn-primary">Editar Tarefa</a>
                <a href="{% url 'tarefas:excluir_tarefa' tarefa.pk %}" class="btn btn-danger">Excluir Tarefa</a>
            </div>
        </div>
    </div>
</main>
{% endblock %}
<!-- Rodapé -->
{% include 'includes/footer.html' %}
