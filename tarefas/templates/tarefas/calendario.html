
{% load static %}

{% block head %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Calensário{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'csstarefa/calendario.css' %}">
    <link rel="stylesheet" href="{% static 'csstarefa/styles.css' %}">
    <!-- Inclua FullCalendar CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}


<!-- Barra de Navegação Principal -->    
{% include 'includes/header.html' %}

{% block content %}
<div class="container calendar-container">
    <div class="calendar-header">
        <h2>Calendário de Tarefas</h2>
        <div class="painel1">
            <a href="{% url 'tarefas:criar_tarefa' %}" class="btn btn-primary">
               <i class="fas fa-plus"></i>  Nova Tarefa
            </a>
        </div>    
    </div>
    <div id="calendar"></div>

    <br></br> <!-- Tema claro / escuro -->
    <div class="painel1">
        <button id="theme-toggle" class="btn-theme-toggle">
            <i class="fas fa-moon"></i>
        </button>
    </div>  
</div>

  


<!-- Rodapé -->
{% include 'includes/footer.html' %}
<!-- Inclua FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/pt-br.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Verificar preferência de tema salva
        const savedTheme = localStorage.getItem('calendar-theme') || 'light';
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
            updateThemeButton('dark');
        }
        
        // Configuração do calendário
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'pt-br',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            buttonText: {
                today: 'Hoje',
                month: 'Mês',
                week: 'Semana',
                day: 'Dia'
            },
            events: [
                {% for evento in eventos %}
                {
                    title: '{{ evento.title|escapejs }}',
                    start: '{{ evento.start }}',
                    color: '{{ evento.color }}',
                    url: '{{ evento.url }}',
                    description: '{{ evento.description|escapejs }}'
                },
                {% endfor %}
            ],
            eventClick: function(info) {
                if (info.event.url) {
                    window.location.href = info.event.url;
                    return false;
                }
            },
            eventContent: function(arg) {
                // Customização do conteúdo do evento
                return {
                    html: `<div class="fc-event-title">${arg.event.title}</div>`
                };
            },
            eventDidMount: function(info) {
                // Tooltip para mostrar descrição
                if (info.event.extendedProps.description) {
                    new bootstrap.Tooltip(info.el, {
                        title: info.event.extendedProps.description,
                        placement: 'top',
                        trigger: 'hover',
                        container: 'body'
                    });
                }
            }
        });
        
        calendar.render();
        
        // Botão de alternar tema
        document.getElementById('theme-toggle').addEventListener('click', function() {
            document.body.classList.toggle('dark-theme');
            
            if (document.body.classList.contains('dark-theme')) {
                localStorage.setItem('calendar-theme', 'dark');
                updateThemeButton('dark');
            } else {
                localStorage.setItem('calendar-theme', 'light');
                updateThemeButton('light');
            }
            
            calendar.updateSize(); // Atualiza o calendário após mudança de tema
        });
        
        function updateThemeButton(theme) {
            const button = document.getElementById('theme-toggle');
            if (theme === 'dark') {
                button.innerHTML = '<i class="fas fa-sun"></i> Tema Claro';
                button.style.backgroundColor = '#f8f9fa';
                button.style.color = '#333';
            } else {
                button.innerHTML = '<i class="fas fa-moon"></i> Tema Escuro';
                button.style.backgroundColor = '#2c3e50';
                button.style.color = 'white';
            }
        }
    });
</script>
{% endblock %}
