
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Relatório de Tarefas</title>
    <style>
        /* ==== ALTERAÇÃO 1: Página em modo Paisagem ==== */
        @page {
            size: A4 landscape;
            margin: 1.5cm;
        }

        body { font-family: 'DejaVu Sans', sans-serif; font-size: 9pt; }
        h1 { text-align: center; margin-bottom: 20px; }
        h2 { margin-top: 20px; margin-bottom: 10px; }
        .logo { text-align: center; margin-bottom: 10px; }
        .logo img { max-width: 150px; height: auto; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }

        /* ==== ALTERAÇÃO 2: Estilo de célula mais compacto e com quebra de linha ==== */
        th, td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: left;
            font-size: 0.8em;
            word-wrap: break-word;
        }

        th { background-color: #f2f2f2; font-weight: bold; }
        .status-badge { display: inline-block; padding: 2px 5px; border-radius: 5px; font-size: 0.9em; color: white; border: 1px solid #555; }
        .badge-pendente { background-color: #ffc107; }
        .badge-andamento { background-color: #007bff; }
        .badge-pausada { background-color: #6c757d; }
        .badge-concluida { background-color: #28a745; }
        .badge-cancelada { background-color: #dc3545; }
        .badge-atrasada { background-color: #ff6347; }
        .analysis-section { margin-top: 30px; }
        .analysis-section h3 { margin-bottom: 10px; }
        .analysis-list { list-style-type: none; padding: 0; }
        .analysis-list li { margin-bottom: 5px; }
        .footer { text-align: center; font-size: 0.8em; margin-top: 30px; color: #777; }
    </style>
</head>
<body>
    <div class="logo">
        {% if logo_path %}
            <img src="{{ logo_path }}" alt="Logotipo">
        {% else %}
            Logotipo Não Encontrado
        {% endif %}
    </div>
    <h1>Relatório de Tarefas</h1>

    <h2>Detalhes das Tarefas</h2>
    <table>
        <thead>
            <tr>
                {# ==== ALTERAÇÃO 3: Cabeçalhos abreviados ==== #}
                <th>Título</th>
                <th>Responsável</th>
                <th>Status</th>
                <th>Prior.</th> {# Abreviado #}
                <th>Projeto</th>
                <th>Criação</th>
                <th>Prazo</th>
                <th>Dur. Prev.</th> {# Abreviado #}
                <th>T. Gasto</th>   {# Abreviado #}
            </tr>
        </thead>
        <tbody>
            {% for tarefa in tarefas %}
            <tr>
                <td>{{ tarefa.titulo }}</td>
                <td>{{ tarefa.responsavel.username|default:"-" }}</td>
                <td><span class="status-badge badge-{{ tarefa.status }}">{{ tarefa.get_status_display }}</span></td>
                <td>{{ tarefa.get_prioridade_display|slice:":3" }}</td> {# Exibe apenas as 3 primeiras letras #}
                <td>{{ tarefa.projeto|default:"-" }}</td>
                {# ==== ALTERAÇÃO 4: Formato de data mais conciso ==== #}
                <td>{{ tarefa.data_criacao|date:"d/m/y" }}</td>
                <td>{{ tarefa.prazo|date:"d/m/y"|default:"-" }}</td>
                <td>{{ tarefa.duracao_prevista|default:"-" }}</td>
                <td>{{ tarefa.tempo_gasto|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="9" style="text-align: center;">Nenhum dado para exibir.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    {# Opcional: Removi colunas da tabela, mas mantive na análise, ou vice-versa #}
    <div class="analysis-section">
        <h3>Análise de Status</h3>
        <ul class="analysis-list">
            {% for item in status_data %}
            <li>
                {{ item.label }}: {{ item.count }} ({{ item.percent }}%)
                
                {% if item.avg_duration %}
                    - Duração Média: {{ item.avg_duration|floatformat:"2" }}
                {% endif %}
            </li>
            {% empty %}
            <li>Nenhum dado de status disponível.</li>
            {% endfor %}
        </ul>
        
        <h3>Análise de Prioridade</h3>
        <ul class="analysis-list">
            {% for item in prioridade_data %}
            <li>{{ item.label }}: {{ item.count }} ({{ item.percent }}%)</li>
            {% empty %}
            <li>Nenhum dado de prioridade disponível.</li>
            {% endfor %}
        </ul>
        </div>

    <div class="footer">
        Relatório gerado em {{ now|date:"d/m/Y H:i:s" }}
    </div>
</body>
</html>

