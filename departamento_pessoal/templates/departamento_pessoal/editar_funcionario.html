
{% load widget_tweaks %}
{% load static %}

{% block content %}
<!-- CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'csstemplate/styles.css' %}">
<link rel="stylesheet" href="{% static 'cssdp/stylesfuncionario.css' %}">

<!-- Barra de Navegação Principal -->
{% include 'includes/header.html' %}

<div class="container">
    <!-- Mensagens -->
    {% if messages %}
    <div class="mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="header-container">
        <h2 class="page-title text-center">{% if form.instance.pk %}Editar{% else %}Cadastro de{% endif %} Funcionário</h2>
        <h4 class="mb-0" align="center">{{ funcionario.nome }}</h4>
    </div>
    <a href="{% url 'departamento_pessoal:lista_funcionarios' %}" class="btn-voltar">
        <i class="bi bi-arrow-left-square-fill"></i> Voltar
    </a>
    <!-- Formulário Principal -->
    <div class="form-container">
        <form method="post" id="funcionarioForm" class="employee-form" novalidate>
            {% csrf_token %}
            
            <!-- Seção 1: Dados Pessoais -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-user"></i> Dados Pessoais
                </h3>
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="{{ form.nome.id_for_label }}" class="form-label">Nome Completo *</label>
                        {{ form.nome|add_class:"form-control" }}
                        {% if form.nome.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.nome.errors.as_text }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group col-md-6">
                        <label for="{{ form.data_nascimento.id_for_label }}" class="form-label">Data Nascimento *</label>
                        <input type="date" 
                               name="{{ form.data_nascimento.name }}" 
                               id="{{ form.data_nascimento.id_for_label }}" 
                               class="form-control" 
                               value="{{ form.data_nascimento.value|date:'Y-m-d' }}">
                        {% if form.data_nascimento.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.data_nascimento.errors.as_text }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="{{ form.naturalidade.id_for_label }}" class="form-label">Naturalidade</label>
                        {{ form.naturalidade|add_class:"form-control" }}
                    </div>
                    
                    <div class="form-group col-md-6">
                        <label for="{{ form.sexo.id_for_label }}" class="form-label">Sexo *</label>
                        {{ form.sexo|add_class:"form-control" }}
                        {% if form.sexo.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.sexo.errors.as_text }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Seção 2: Contato -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-address-book"></i> Contato
                </h3>
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="{{ form.telefone.id_for_label }}" class="form-label">Telefone *</label>
                        {{ form.telefone|add_class:"form-control telefone-mask"|attr:"placeholder:(00) 00000-0000" }}
                        {% if form.telefone.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.telefone.errors.as_text }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group col-md-6">
                        <label for="{{ form.email.id_for_label }}" class="form-label">E-mail *</label>
                        {{ form.email|add_class:"form-control" }}
                        {% if form.email.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.email.errors.as_text }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Seção 3: Status -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-info-circle"></i> Status
                </h3>
                
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="{{ form.estatus.id_for_label }}" class="form-label">Situação *</label>
                        {{ form.estatus|add_class:"form-control" }}
                        {% if form.estatus.errors %}
                            <div class="invalid-feedback d-block">
                                {{ form.estatus.errors.as_text }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Botões de Ação -->
            <div class="form-actions">
                <button type="submit" class="btn-save">
                    <i class="fas fa-save"></i> Salvar
                </button>
                <a href="{% url 'departamento_pessoal:lista_funcionarios' %}" class="btn-cancel">
                    <i class="fas fa-times"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
    
    {% if not form.instance.pk %}
    <div class="form-info">
        <p><i class="fas fa-info-circle"></i> Após salvar, você será redirecionado para cadastrar os documentos do funcionário.</p>
    </div>
    {% endif %}
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function() {
    // Máscaras
    $('.telefone-mask').mask('(00) 00000-0000');
    
    // Validação do formulário
    $('#funcionarioForm').submit(function(e) {
        let isValid = true;
        $('[required]').each(function() {
            if ($(this).val() === '') {
                $(this).addClass('is-invalid');
                isValid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            $('html, body').animate({
                scrollTop: $('.is-invalid').first().offset().top - 100
            }, 500);
            
            // Mostrar alerta de campos obrigatórios
            alert('Por favor, preencha todos os campos obrigatórios.');
        }
    });
});
</script>
{% endblock %}

<!-- Rodapé -->
{% include 'includes/footer.html' %}