

{% load static %}
{% load widget_tweaks %}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<link rel="stylesheet" href="{% static 'csstemplate/styles.css' %}">
<link rel="stylesheet" href="{% static 'cssdp/stylesEditaDocumentos.css' %}">

<!-- Barra de Navegação Principal -->
{% include 'includes/header.html' %}

{% block content %}
<div class="container py-4">
    <div class="card mx-auto" style="max-width: 1200px;">
        <div class="card-header">
            <h3 class="card-title text-black">
                <i class="fas fa-id-card"></i> Editar Documentos - {{ funcionario.nome }}
            </h3>
        </div>
        
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" novalidate class="needs-validation">
                {% csrf_token %}
                
                <!-- Seção Documentos Básicos -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2">
                        <i class="fas fa-id-card"></i> Documentos Básicos
                    </h5>
                    
                    <div class="row">
                        <!-- CPF -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label">CPF *</label>
                            {{ form.cpf|add_class:"form-control" }}
                            {% if form.cpf.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.cpf.errors.as_text }}
                                </div>
                            {% endif %}
                        </div>
                        <!-- RG -->
                        <div class="form-group col-md-4">
                            <label for="{{ form.rg.id_for_label }}" class="form-label">RG *</label>
                            {{ form.rg|add_class:"form-control" }}
                            <small class="form-text text-muted">Formato: 00.000.000-0</small>
                            {% if form.rg.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.rg.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <!-- Órgão Emissor -->
                        <div class="col-md-2 mb-3">
                            <label class="form-label">Emissor *</label>
                            {{ form.emissor|add_class:"form-control" }}
                        </div>
                        
                        <!-- UF -->
                        <div class="col-md-2 mb-3">
                            <label class="form-label">UF *</label>
                            {{ form.uf|add_class:"form-select" }}
                        </div>
                    </div>
                    
                    <!-- Anexos RG/CPF -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Anexo CPF</label>
                            {{ form.anexo_cpf|add_class:"form-control" }}
                            {% if documentos.anexo_cpf %}
                                <small class="text-muted">
                                    <a href="{{ documentos.anexo_cpf.url }}" target="_blank">
                                        Ver documento atual
                                    </a>
                                </small>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Anexo RG</label>
                            {{ form.anexo_rg|add_class:"form-control" }}
                            {% if documentos.anexo_rg %}
                                <small class="text-muted">
                                    <a href="{{ documentos.anexo_rg.url }}" target="_blank">
                                        Ver documento atual
                                    </a>
                                </small>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Seção Documentos Trabalhistas -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2">
                        <i class="fas fa-briefcase"></i> Documentos Trabalhistas
                    </h5>
                    
                    <div class="row">
                        <!-- PIS -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label">PIS/PASEP</label>
                            {{ form.pis|add_class:"form-control" }}
                        </div>
                        
                        <!-- CTPS -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label">CTPS</label>
                            {{ form.ctps|add_class:"form-control" }}
                        </div>
                    </div>
                    
                    <!-- Anexos Trabalhistas -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Anexo PIS</label>
                            {{ form.anexo_pis|add_class:"form-control" }}
                            {% if documentos.anexo_pis %}
                                <small class="text-muted">
                                    <a href="{{ documentos.anexo_pis.url }}" target="_blank">
                                        Ver documento atual
                                    </a>
                                </small>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Anexo CTPS</label>
                            {{ form.anexo_ctps|add_class:"form-control" }}
                            {% if documentos.anexo_ctps %}
                                <small class="text-muted">
                                    <a href="{{ documentos.anexo_ctps.url }}" target="_blank">
                                        Ver documento atual
                                    </a>
                                </small>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Seção Documentos Militares/Eleitorais -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2">
                        <i class="fas fa-file-alt"></i> Outros Documentos
                    </h5>
                    
                    <div class="row">
                        <!-- Título Eleitor -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Título Eleitor</label>
                            {{ form.titulo_eleitor|add_class:"form-control" }}
                        </div>
                        
                        <!-- Reservista -->
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Cert. Reservista</label>
                            {{ form.reservista|add_class:"form-control" }}
                        </div>
                    </div>
                </div>
                
                <!-- Botões -->
                <div class="d-flex flex-column flex-md-row justify-content-between gap-3 mt-4">
                    <a href="{% url 'departamento_pessoal:detalhe_funcionario' funcionario.id %}" class="btn btn-secondary btn-lg flex-grow-1">
                        <i class="fas fa-arrow-left me-2"></i> Voltar
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg flex-grow-1">
                        <i class="fas fa-save me-2"></i> Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JavaScript para máscaras e validação -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
$(document).ready(function() {
    // Aplicar máscaras
    $('[data-mask]').each(function() {
        $(this).mask($(this).data('mask'));
    });
    
    // Validação customizada
    $('form').submit(function(e) {
        let isValid = true;
        
        // Validar campos obrigatórios
        $('[required]').each(function() {
            if ($(this).val().trim() === '') {
                $(this).addClass('is-invalid');
                isValid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            $('html, body').animate({
                scrollTop: $('.is-invalid').first().offset().top - 100
            }, 500);
        }
    });
});
</script>
{% endblock %}
<!-- Rodapé -->
{% include 'includes/footer.html' %}
