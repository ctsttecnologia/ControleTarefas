

{% extends "base.html" %}
{% load static %}

{% block title %}{{ titulo_pagina|default:"Painel DP" }}{% endblock %}


{% block content %}
<div class="container mt-4">

    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100 shadow-sm">
                <div class="card-body">
                    <i class="bi bi-people-fill fs-2 text-primary"></i>
                    <h2 class="display-6 fw-bold">{{ total_funcionarios_ativos|default:"0" }}</h2>
                    <p class="text-muted mb-0">Funcionários Ativos</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100 shadow-sm">
                <div class="card-body">
                    <i class="bi bi-building fs-2 text-primary"></i>
                    <h2 class="display-6 fw-bold">{{ total_departamentos|default:"0" }}</h2>
                    <p class="text-muted mb-0">Departamentos</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100 shadow-sm">
                <div class="card-body">
                    <i class="bi bi-person-badge fs-2 text-primary"></i>
                    <h2 class="display-6 fw-bold">{{ total_cargos|default:"0" }}</h2>
                    <p class="text-muted mb-0">Cargos</p>
                </div>
            </div>
        </div>
    </div>

    <h3 class="mt-4">Análises Rápidas</h3>
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">Funcionários por Departamento</div>
                <div class="card-body">
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header">Distribuição por Status</div>
                <div class="card-body">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <h3 class="mt-4">Gerenciar</h3>
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <a href="{% url 'departamento_pessoal:lista_funcionarios' %}" class="nav-card">
                        <div class="nav-icon"><i class="bi bi-people"></i> Funcionários</div>
                    </a>    
                    <p class="nav-text">Gerencie os dados cadastrais, admissões e documentos dos colaboradores.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <a href="{% url 'departamento_pessoal:lista_departamento' %}" class="nav-card">
                        <div class="nav-icon"><i class="bi bi-diagram-3"></i> Departamentos</div>
                    </a>    
                    <p class="nav-text">Estruture os centros de custo e os departamentos da empresa.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <a href="{% url 'departamento_pessoal:lista_cargo' %}" class="nav-card">
                        <div class="nav-icon"><i class="bi bi-briefcase"></i> Cargos </div>
                    </a>    
                    <p class="nav-text">Cadastre e organize os cargos e suas descrições.</p>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}



{% block extra_js %}
    {{ block.super }} {# Inclui o conteúdo do bloco do base.html (o script do Chart.js) #}

    {{ depto_labels|json_script:"department-labels" }}
    {{ depto_data|json_script:"department-data" }}
    {{ status_labels|json_script:"status-labels" }}
    {{ status_data|json_script:"status-data" }}

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- GRÁFICO 1: Funcionários por Departamento (Pizza) ---
        const departmentLabels = JSON.parse(document.getElementById('department-labels').textContent);
        const departmentData = JSON.parse(document.getElementById('department-data').textContent);
        
        const departmentCtx = document.getElementById('departmentChart').getContext('2d');
        
        if (departmentData.length > 0) {
            new Chart(departmentCtx, {
                type: 'pie',
                data: {
                    labels: departmentLabels,
                    datasets: [{
                        label: 'Nº de Funcionários',
                        data: departmentData,
                        backgroundColor: ['#0d6efd', '#6f42c1', '#198754', '#d63384', '#fd7e14', '#20c997', '#ffc107', '#0dcaf0', '#6c757d', '#343a40'],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        // --- GRÁFICO 2: Distribuição por Status (Doughnut) ---
        const statusLabels = JSON.parse(document.getElementById('status-labels').textContent);
        const statusData = JSON.parse(document.getElementById('status-data').textContent);

        const statusCtx = document.getElementById('statusChart').getContext('2d');
        const statusColors = {'Ativo': '#198754', 'Férias': '#ffc107', 'Inativo': '#dc3545', 'Afastado': '#6c757d'};

        if (statusData.length > 0) {
            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: statusLabels,
                    datasets: [{
                        label: 'Nº de Funcionários',
                        data: statusData,
                        backgroundColor: statusLabels.map(label => statusColors[label] || '#0dcaf0'),
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, cutout: '50%'}
            });
        }
    });
    </script>
{% endblock %}<a href="#" class="btn btn-primary">Acessar</a>