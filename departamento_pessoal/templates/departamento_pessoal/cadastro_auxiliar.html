
{% load static widget_tweaks %}

{% block content %}


<!-- Barra de Navegação Principal -->
{% include 'includes/header.html' %}

<div class="container-fluid">
    <h2 class="mb-4">Cadastros Auxiliares</h2>
    
    <ul class="nav nav-tabs" id="cadastroTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="departamentos-tab" data-toggle="tab" href="#departamentos" role="tab">
                <i class="fas fa-building"></i> Departamentos
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="cbos-tab" data-toggle="tab" href="#cbos" role="tab">
                <i class="fas fa-id-card-alt"></i> CBOs
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="cargos-tab" data-toggle="tab" href="#cargos" role="tab">
                <i class="fas fa-briefcase"></i> Cargos
            </a>
        </li>
    </ul>
    
    <div class="tab-content border-left border-right border-bottom p-4" id="cadastroTabsContent">
        <!-- Tab Departamentos -->
        <div class="tab-pane fade show active" id="departamentos" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <h4>Novo Departamento</h4>
                    <form method="post" action="{% url 'departamento_pessoal:cadastrar_departamento' %}" class="mb-4">
                        {% csrf_token %}
                        {% for field in departamento_form %}
                            <div class="form-group">
                                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                                {{ field|add_class:"form-control" }}
                                {% if field.help_text %}
                                    <small class="form-text text-muted">{{ field.help_text }}</small>
                                {% endif %}
                                {% for error in field.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar
                        </button>
                    </form>
                </div>
                
                <div class="col-md-6">
                    <h4>Departamentos Cadastrados</h4>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Nome</th>
                                    <th>Sigla</th>
                                    <th>Tipo</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for depto in departamentos %}
                                <tr>
                                    <td>{{ depto.nome }}</td>
                                    <td>{{ depto.sigla }}</td>
                                    <td>{{ depto.get_tipo_display }}</td>
                                    <td>
                                        {% if depto.ativo %}
                                            <span class="badge badge-success">Ativo</span>
                                        {% else %}
                                            <span class="badge badge-secondary">Inativo</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="#" class="btn btn-sm btn-danger" title="Excluir">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">Nenhum departamento cadastrado</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab CBOs -->
        <div class="tab-pane fade" id="cbos" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <h4>Novo CBO</h4>
                    <form method="post" action="{% url 'departamento_pessoal:cadastrar_cbo' %}" class="mb-4">
                        {% csrf_token %}
                        {% for field in cbo_form %}
                            <div class="form-group">
                                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                                {{ field|add_class:"form-control" }}
                                {% if field.help_text %}
                                    <small class="form-text text-muted">{{ field.help_text }}</small>
                                {% endif %}
                                {% for error in field.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar
                        </button>
                    </form>
                </div>
                
                <div class="col-md-6">
                    <h4>CBOs Cadastrados</h4>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Código</th>
                                    <th>Título</th>
                                    <th>Descrição</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cbo in cbos %}
                                <tr>
                                    <td>{{ cbo.codigo }}</td>
                                    <td>{{ cbo.titulo }}</td>
                                    <td>{{ cbo.descricao|truncatechars:50 }}</td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="#" class="btn btn-sm btn-danger" title="Excluir">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">Nenhum CBO cadastrado</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Cargos -->
        <div class="tab-pane fade" id="cargos" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <h4>Novo Cargo</h4>
                    <form method="post" action="{% url 'departamento_pessoal:cadastrar_cargo' %}" class="mb-4">
                        {% csrf_token %}
                        {% for field in cargo_form %}
                            <div class="form-group">
                                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                                {% if field.name == 'cbo' %}
                                    <select name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-control">
                                        {% for cbo in cbos %}
                                            <option value="{{ cbo.pk }}">{{ cbo.codigo }} - {{ cbo.titulo }}</option>
                                        {% endfor %}
                                    </select>
                                {% else %}
                                    {{ field|add_class:"form-control" }}
                                {% endif %}
                                {% if field.help_text %}
                                    <small class="form-text text-muted">{{ field.help_text }}</small>
                                {% endif %}
                                {% for error in field.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar
                        </button>
                    </form>
                </div>
                
                <div class="col-md-6">
                    <h4>Cargos Cadastrados</h4>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Nome</th>
                                    <th>CBO</th>
                                    <th>Salário Base</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cargo in cargos %}
                                <tr>
                                    <td>{{ cargo.nome }}</td>
                                    <td>{{ cargo.cbo.codigo }}</td>
                                    <td>R$ {{ cargo.salario_base }}</td>
                                    <td>
                                        {% if cargo.ativo %}
                                            <span class="badge badge-success">Ativo</span>
                                        {% else %}
                                            <span class="badge badge-secondary">Inativo</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="#" class="btn btn-sm btn-primary" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="#" class="btn btn-sm btn-danger" title="Excluir">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">Nenhum cargo cadastrado</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function() {
    // Ativa as tabs
    $('#cadastroTabs a').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show');
    });
    
    // Validação dos formulários
    $('form').submit(function(e) {
        let isValid = true;
        $(this).find('[required]').each(function() {
            if ($(this).val() === '') {
                $(this).addClass('is-invalid');
                isValid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            $('html, body').animate({
                scrollTop: $(this).find('.is-invalid').first().offset().top - 100
            }, 500);
        }
    });
});
</script>
{% endblock %}

<!-- Rodapé -->
{% include 'includes/footer.html' %}

