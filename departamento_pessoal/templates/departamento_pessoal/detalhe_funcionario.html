{% extends 'base.html' %}

{% load static %}

{% block head %}

    {% block extra_css %}{% endblock %}
{% endblock %}

{% block content %}
<div class="container">
    <!-- Mensagens -->
    {% if messages %}
    <div class="mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Detalhes do Funcionário</h2>
        <div>
            <a href="{% url 'departamento_pessoal:departamento_pessoal' %}" class="btn btn-outline-primary">
                <i class="fas fa-home"></i> Departamento Pessoal
            </a>
            <a href="{% url 'departamento_pessoal:lista_funcionarios' %}" class="btn btn-outline-secondary">
                <i class="fas fa-list"></i> Lista de Funcionários
            </a>
        </div>
    </div>

    <!-- Informações Pessoais -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h4><i class="fas fa-user"></i> Informações Pessoais</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Nome:</strong> {{ funcionario.nome }}</p>
                    <p><strong>Data de Nascimento:</strong> {{ funcionario.data_nascimento|date:"d/m/Y" }}</p>
                    <p><strong>Idade:</strong> {{ funcionario.idade }} anos</p>
                    <p><strong>Naturalidade:</strong> {{ funcionario.naturalidade|default:"-" }}</p>
                    <p><strong>Sexo:</strong> {{ funcionario.get_sexo_display }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Telefone:</strong> {{ funcionario.telefone_formatado|default:"-" }}</p>
                    <p><strong>Email:</strong> {{ funcionario.email|default:"-" }}</p>
                    <p><strong>Status:</strong> 
                        <span class="badge 
                            {% if funcionario.estatus == 1 %}bg-success
                            {% elif funcionario.estatus == 2 %}bg-warning
                            {% elif funcionario.estatus == 3 %}bg-danger
                            {% else %}bg-secondary{% endif %}">
                            {{ funcionario.get_estatus_display }}
                        </span>
                    </p>
                    <p><strong>Data de Cadastro:</strong> {{ funcionario.data_cadastro|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Seção de Admissão -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h4><i class="fas fa-briefcase"></i> Dados de Admissão</h4>
        </div>
        <div class="card-body">
            {% if funcionario.admissao %}
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Matrícula:</strong> {{ funcionario.admissao.matricula }}</p>
                    <p><strong>Cargo:</strong> {{ funcionario.admissao.cargo.nome }}</p>
                    <p><strong>Departamento:</strong> {{ funcionario.admissao.departamento.nome }}</p>
                    <p><strong>Tipo de Contrato:</strong> {{ funcionario.admissao.get_tipo_contrato_display }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Data de Admissão:</strong> {{ funcionario.admissao.data_admissao|date:"d/m/Y" }}</p>
                    <p><strong>Salário:</strong> R$ {{ funcionario.admissao.salario|floatformat:2 }}</p>
                    <p><strong>Horário:</strong> 
                        {% if funcionario.admissao.hora_entrada and funcionario.admissao.hora_saida %}
                            {{ funcionario.admissao.hora_entrada|time:"H:i" }} às {{ funcionario.admissao.hora_saida|time:"H:i" }}
                        {% else %}
                            Não definido
                        {% endif %}
                    </p>
                    <p><strong>Dias Trabalhados:</strong> {{ funcionario.admissao.get_dias_semana_display }}</p>
                </div>
            </div>
            {% else %}
            <div class="alert alert-warning">
                Nenhuma admissão registrada para este funcionário.
                <!--<a href="{% url 'departamento_pessoal:nova_admissao' funcionario.pk %}" 
                class="btn btn-sm btn-primary ms-3">
                Cadastrar Admissão
                </a>-->
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Seção de Documentos -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h4><i class="fas fa-id-card"></i> Documentos Pessoais</h4>
        </div>
        <div class="card-body">
            {% if funcionario.documentos %}
            <div class="row">
                <div class="col-md-6">
                    <p><strong>CPF:</strong> {{ funcionario.documentos.cpf_formatado }}</p>
                    <p><strong>RG:</strong> {{ funcionario.documentos.rg_formatado }}</p>
                    <p><strong>Órgão Emissor:</strong> {{ funcionario.documentos.emissor|default:"-" }}</p>
                    <p><strong>UF Emissor:</strong> {{ funcionario.documentos.get_uf_display|default:"-" }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>PIS/PASEP:</strong> {{ funcionario.documentos.pis_formatado|default:"-" }}</p>
                    <p><strong>CTPS:</strong> {{ funcionario.documentos.ctps|default:"-" }}</p>
                    <p><strong>Título Eleitor:</strong> {{ funcionario.documentos.titulo_eleitor|default:"-" }}</p>
                    <p><strong>Certificado Reservista:</strong> {{ funcionario.documentos.reservista|default:"-" }}</p>
                </div>
            </div>
            
            <!-- Anexos -->
            <div class="mt-4">
                <h5><i class="fas fa-paperclip"></i> Anexos</h5>
                <div class="row">
                    <div class="col-md-3">
                        <p><strong>CPF:</strong> 
                            {% if funcionario.documentos.anexo_cpf %}
                            <a href="{{ funcionario.documentos.anexo_cpf.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i> Visualizar
                            </a>
                            {% else %}
                            Não enviado
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-3">
                        <p><strong>RG:</strong> 
                            {% if funcionario.documentos.anexo_rg %}
                            <a href="{{ funcionario.documentos.anexo_rg.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i> Visualizar
                            </a>
                            {% else %}
                            Não enviado
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-3">
                        <p><strong>PIS:</strong> 
                            {% if funcionario.documentos.anexo_pis %}
                            <a href="{{ funcionario.documentos.anexo_pis.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i> Visualizar
                            </a>
                            {% else %}
                            Não enviado
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-3">
                        <p><strong>CTPS:</strong> 
                            {% if funcionario.documentos.anexo_ctps %}
                            <a href="{{ funcionario.documentos.anexo_ctps.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i> Visualizar
                            </a>
                            {% else %}
                            Não enviado
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-warning">
                Nenhum documento cadastrado para este funcionário.
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Botões de Ação -->
    <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'departamento_pessoal:lista_funcionarios' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Voltar
        </a>
        <div>
            {% if funcionario.documentos.pk %}
                <a href="{% url 'departamento_pessoal:editar_documentos' funcionario_pk=funcionario.pk pk=funcionario.documentos.pk %}"
                    class="btn btn-primary" title="Editar Documentos">
                    <i class="fas fa-file-edit"></i> Editar Documentos
                </a>
            {% else %}
                <a href="{% url 'departamento_pessoal:cadastrar_documentos' funcionario.pk %}" 
                    class="btn btn-primary" title="Cadastrar Documentos">
                    <i class="fas fa-file-alt"></i> Cadastrar Documentos
                </a>
            {% endif %}
            
            {% if funcionario.admissao.pk %}
                <a href="{% url 'departamento_pessoal:editar_admissao' funcionario_pk=funcionario.pk pk=funcionario.admissao.pk %}" 
                    class="btn btn-primary" title="Editar Admissão">
                    <i class="fas fa-edit"></i> Editar Admissão
                </a>
            {% else %}
                <a href="{% url 'departamento_pessoal:nova_admissao' funcionario.pk %}" 
                    class="btn btn-primary" title="Cadastrar Admissão">
                    <i class="fas fa-file-alt"></i> Cadastrar Admissão
                </a>
            {% endif %}
            <a href="{% url 'departamento_pessoal:editar_funcionario' funcionario.pk %}" class="btn btn-primary">
                <i class="fas fa-edit"></i> Editar Funcionário
            </a>
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
                <i class="fas fa-trash"></i> Excluir
            </button>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Exclusão</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Tem certeza que deseja excluir o funcionário <strong>{{ funcionario.nome }}</strong>? Esta ação não pode ser desfeita.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form method="post" action="{% url 'departamento_pessoal:confirmar_exclusao' funcionario.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Confirmar Exclusão</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

