
{% load static %}
{% load tz %} 
{% load humanize %}

{% if user.is_authenticated %}

<button type="button" class="floating-chat-btn" id="chat-modal-trigger" 
    title="Abrir Lista de Chats" 
    aria-label="Abrir Lista de Chats"
    onclick="window.toggleChatListSidebar()">
    <i class="bi bi-chat-dots"></i>
</button>

<div class="chat-overlay" id="chatOverlay" onclick="window.toggleChatListSidebar()"></div>

<aside class="chat-sidebar-container" id="chatListContainer">
    <div class="chat-list-inner">
        <header class="chat-list-header">
            <h2>Minhas Conversas</h2>
            <button type="button" class="chat-close-btn" onclick="window.toggleChatListSidebar()" aria-label="Fechar lista de chats">
                <i class="bi bi-x-lg"></i>
            </button>
        </header>

        <div class="chat-list-body">
            <div class="chat-list-action">
                <a href="#" id="iniciar-nova-conversa">
                    <i class="bi bi-pencil-square"></i>
                    <span>Iniciar Nova Conversa</span>
                </a>
            </div>
            
            <section class="chat-list-section">
                <h3>Chats de Tarefas</h3>
                <div class="chat-list-empty-state">
                    <i class="bi bi-chat-text"></i>
                    <p>Sem chats ativos de tarefas.</p>
                </div>
            </section>
            <section class="chat-list-section">
                <h3>Salas de Grupo</h3>
                <div class="chat-list-empty-state">
                    <i class="bi bi-people"></i>
                    <p>Sem grupos ativos.</p>
                </div>
            </section>
            <section class="chat-list-section">
                <h3>Conversas Individuais (DMs)</h3>
                <div class="chat-list-empty-state">
                    <i class="bi bi-person"></i>
                    <p>Você não tem conversas individuais.</p>
                </div>
            </section>
        </div>
    </div>
</aside>

<div class="modal fade" id="novaConversaModal" tabindex="-1" 
     aria-labelledby="novaConversaModalLabel" aria-hidden="true"
     data-user-list-url="{% url 'chat:get_user_list' %}">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="novaConversaModalLabel">Iniciar Nova Conversa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="user-list-body">
                <div class="text-center"> 
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Carregando usuários...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="chat-draggable-container" id="chat-draggable-container" style="display: none;">
    
    <div class="chat-dialog-header" id="chat-dialog-header-bar">
        <span id="chat-dialog-header-title">Conversa</span>
        
        <div class="d-flex align-items-center">
            <button type="button" class="close-chat-btn" id="minimize-chat-btn" title="Minimizar" aria-label="Minimizar chat" style="font-weight: bold; padding-right: 10px;">
                _
            </button>
            
            <button type="button" class="close-chat-btn" id="close-dialog-btn" title="Fechar" aria-label="Fechar chat">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    </div>
    
    <div class="chat-dialog-body" id="chat-log">
        </div>
    
    <div class="chat-dialog-footer">
        <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
        
        <button class="chat-footer-btn" id="upload-image-btn" title="Anexar arquivo" aria-label="Anexar arquivo">
            <i class="bi bi-paperclip"></i>
        </button>
        
        <textarea id="chat-message-input" class="chat-message-input" rows="1" placeholder="Digite sua mensagem..."></textarea>
        
        <button class="chat-footer-btn" id="chat-message-submit" title="Enviar" aria-label="Enviar mensagem">
            <i class="bi bi-send-fill"></i>
        </button>
    </div>
</div>

{% endif %}
